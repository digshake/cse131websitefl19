---
name: Create an Instrument
week: 4
number: 1
points: 6
---

We have seen how <a href="http://www.jimloy.com/physics/harmony.htm">sound can be represented as a summation of sine waves</a>. In this extension, you will process a description of an instrument, which specifies the relative intensities of that instruments <a href="">overtones</a>.  You will modify a copy of `PlayThatTune` so that the sound emitted for each note has the profile of the specified instrument.

##Warm Up

* Locate the `instrument` package in the `extensions` folder.  

* You will find a copy of `PlayThatTune` in the `instrument` package, credited to Sedgewick\'s book, as this code is adpated from Sedgewick\'s `PlayThatTune`.

* Run `PlayThatTune` and verify that it plays the music files correctly.

##Overview

* For the purposes of this work, let\'s define a <I>frequency factor</I> as a multiplicative factor to be applied to a frequency `f`:

In the example below, let\'s assume that `f` is 440&nbsp;Hz (cycles per second), which is concert A. On a piano, this is the A above middle C:

![](../../../extensions/a440.gif)

* a factor of `1` results in the same frequency as `f`, because `1*f==f`.

* a factor of `2` yields a frequency **an octave higher** than `f`.

For this example, we obtain 880 Hz, which is the A above high C on a piano:

![](../../../extensions/a880.gif)

* a factor of `4` yields a frequency **two octaves higher** than `f`.  

Here we obtain 1760 Hz, an octave above the A above high C:

![](../../../extensions/a1760.gif)

* a factor of `3` is between one and two octaves higher, and it turns out to be one octave plus  a <a href="http://en.wikipedia.org/wiki/Perfect_fifth">just (or, pure) fifth</a> above the pitch corresponding to `f`.

Here we obtain the frequency 1320&nbsp;Hz, which sounds like the E above high C.

![](../../../extensions/e3x.gif)

The sound is slightly different than on a piano, where the pitches are not perfect but are instead evenly spaced apart from each other.  The corresponding note on the piano has a frequency of 1318.51&nbsp;Hz, slightly flatter than
what we get by our frequency factor.

* a factor of `0.75` (ratio of 3:4) yields a note that sounds like an E, but dividing by 4 lowers its
pitch by two octaves.   With `f` at concert A, a frequency factor of 3:4 yields a frequency of 330, whichsounds like the E above middle C:

![](../../../extensions/e34.gif)

Again, the pitch on a piano is slightly different;  in this case it
is slightly flatter at  329.63.

* It is thus convenient to specify a frequency factor as the ratio of
two integers.  In the above examples we see 1:1, 2:1, 4:1, 3:1, and 3:4.

* To build an actual instrument, we must pick the frequency factors we
wish to hear, and specify how strong each should be.  The table below
specifies such an instrument:

| Frequency Factor || Relative Strength|
:-----------------:|:---------:|
|Numerator | Denominator | |
| 1 | 1 | 1 |
| 2 | 1 | 0.75 |
| 3 | 2 | 0.50 |

The first row is the fundamental frequency.  The second is an octave higher, and is 3/4 as strong as the fundamental frequency.  The third row specifies a
pitch that is a fifth above the fundamental freqnecy, and quieter still at
half the strength of the fundamental frequency.

The waveform that results from such an instrument specification is shown
below in red, with the three frequency factors shown in black:

![](../../../extensions/instr.jpg)

* The red solid waveformis literally the sum of the
black dotted waveforms. The 
sound you produce is sampled from the red waveform, and that **is** the
subject of this extension.

* The plot shown above is not the subject of this extension, but is shown
to help explain how complex sounds are built from simple ones,
as follows:

	* The black waveform with the largest <a href="http://en.wikipedia.org/wiki/Amplitude">amplitude</a> (the tallest
	black waveform) is the fundamental frequency
	at relative strength 1.  The sample shown is for 1/440 of a second of a
	440&nbsp;Hz concert-A.  This is sufficient ot show one full cycle of the
	fundamental frequency.
	
	* The black waveform with the next largest amplitude has relative strength 0.75.  It is
	an octave higher, so it oscillates twice in the timespan of the
	fundamental pitch\'s waveform.
	
	* The black waveform of smallest amplitude (at half the strength of
	the fundamental frequency) is the 3:2 frequency factor, which sounds
	like a fifth above the fundamental frequency.  As expected, it exhibits 
	1.5 cycles in the timespan of the fundamental pitch\'s waveform.

* The sound of the red waveform, which is what you will produce below, is
similar to an oboe or a clarinet.

##Procedure

1. First prompt the user for how many frequency factors the user wishes
to specify.  In the above example, 3 such frequencies were used.

2. For each frequency factor, prompt the user for its
	
	1. Numerator (an `int`)
  
	2. Denominator (an `int`)
	
	3. Relative strength (a `double`)

	> The information about the frequency factors must be saved (in arrays)
	> for future use.

3. The code in `PlayThatTune`, copied with attribution
	from `PlayThatTune`, reads in a file and computes a value
	in a variable called `hz` that is the fundamental frequency
	of the tune being played.

	The `hz` value is computed from concert A (440&nbsp;Hz), taking the specified
	number of equally spaced chromatic steps above (or below) concert A.
	
	The relevant details, explained in the lecture slides for this module,
	are not necessary to complete this extension, but please ask if you would
	like clarification.

4. Your task is to modify the assignment to the sample `a[i]` in
	the provided code:
	
	![](../../../extensions/origformula.png)
	
	The sine wave sampled and assigned there is for:

	1. the fundamental frequency (`hz`, shown in the red box) of the desired pitch

	2. relative strength `1.0` (the result of the sine function call
	is implicitly multiplied by 1, shown at the red dot).

	In place of that value, you must compute the sum of sine wave samples, one
	for each frequency factor, as follows:

	* `a[i]` is initially zero.
	
	* For each frequency factor
	`f<sub>k</sub>`, add to `a[i]` a sample obtained
	as follows:
	
		* The value passed to the sine function must be multiplied by the 
		frequency factor.  This means multiplying the red-boxed `hz` by the ratio of the
		numerator and denominator of the frequency factor.

		* The value returned from the sine function must be multiplied by the
		relative strength of the frequency factor.  This happens at the red dot.

5. Test your program on the `A.txt` file first, which is a
	single note.  Then try `Ascale.txt` and some other songs.